<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no">
        <meta name="format-detection" content="email=no">

        <title>Property Finder</title>
        
        <script>
            (function(){
                function importStyleSheet(url) {
                    document.write(
                        '<style type="text/css">@import "' + url + '";</style>'
                    );
                }
                if(/android/i.test(navigator.userAgent)){
                    importStyleSheet("themes/jqtouch.css");
                } else {
                    importStyleSheet("themes/apple.css");
                }
            }());
        </script>
        <style type="text/css">@import "style/css/app.css"</style>
        <script data-main="cs!main" src="lib/require.js"></script>
    </head>
    <body>
        <div id="jqt">
            <div id="home">
                <div class="toolbar">
                    <h1>Property Finder</h1>
                    <a class="button" href="#favourites">Faves</a>
                </div>
                <div class="scroll">
                    <div class="intro">
                        Use the form below to search for houses to buy. You can search by place-name,
                        postcode, or click 'My location', to search in your current location!
                    </div>
                    <form>
                        <ul class="rounded">
                            <li>
                                <img class="loading" style="display: none;" data-bind="visible: searchInProgress()"
                                    src="style/img/ajax-loader.gif" />
                                <input type="text" data-bind="value: location" placeholder="Location" />
                            </li>
                        </ul>
                    </form>
                    <ul class="individual">
                        <li>
                            <a href="#" data-bind="click: stringSearch">GO</a>
                        </li>
                        <li>
                            <a href="#" data-bind="click: geoSearch">My Location</a>
                        </li>
                    </ul>

                    <div class="info" style="display:none" data-bind="visible: errorState().length > 0, text: errorState"></div>
                    
                    <h2 style="display:none" data-bind="visible: recentSearches().length > 0
                            && possibleLocations().length === 0">Recent searches</h2>
                    <ul style="display:none" class="rounded" data-bind="foreach: recentSearches,
                            visible: recentSearches().length > 0 && possibleLocations().length === 0">
                        <li class="arrow">
                            <a href="#" data-bind="click: $root.recentSearch.bind($root, $data)">
                                <span class="searchTerm" data-bind="text: long_title"></span>
                                <small class="counter" data-bind="number: count"></small>
                            </a>
                        </li>
                    </ul>
                    
                    <h2 style="display:none" data-bind="visible: possibleLocations().length > 0">Did you mean?</h2>
                    <ul style="display:none" class="rounded"
                            data-bind="foreach: possibleLocations, visible: possibleLocations().length > 0">
                        <li class="arrow">
                            <a href="#" data-bind="click: $root.searchWithName.bind($root, place_name)">
                                <span data-bind="text: long_title"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="favourites">
                <div class="toolbar">
                    <h1>Favourites</h1>
                    <a class="back" href="#">Back</a>
                </div>
                <div class="info" data-bind="visible: favourites().length === 0">
                    You have not added any properties to your favourites
                </div>
                <ul class="edgetoedge listings scroll" data-bind="
                    template: { name: 'resultItemTemplate', foreach: favourites },
                    visible: favourites().length > 0"></ul>
            </div>

            <div id="listings">
                <div class="toolbar">
                    <h1>Results</h1>
                    <a class="back" href="#">Back</a>
                </div>
                <ul class="edgetoedge listings scroll">
                    <li class="numResults">
                        Showing <span data-bind="number: listings().length"></span> of 
                            <span data-bind="number: totalResults"></span> matches
                    </li>
                    <!-- ko template: { name: 'resultItemTemplate', foreach: listings } -->
                    <!-- /ko -->
                    <li class="loadMore" data-bind="visible: listings().length < totalResults()">
                        <img class="loading" style="display: none;" data-bind="visible: searchInProgress()"
                            src="style/img/ajax-loader.gif" />
                        <a href="#" data-bind="click: loadMore">Load More</a>
                    </li>
                </ul>
            </div>

            <div id="listingDetail" data-bind="with: selectedProperty">
                <div class="toolbar">
                    <h1>Information</h1>
                    <a class="back" href="#">Back</a>
                    <a class="button star" href="#addToFaves" data-bind="click: toggleInFavourites,
                            text: favourite() ? '&#9733;' : '&#9734;'"></a>
                </div>
                <div class="scroll">
                    <div data-bind="currency: price"></div>
                    <div data-bind="title: title"></div>
                    <img class="detailImage" data-bind="attr: { src: img_url }" />
                    <div class="roomDetail">
                        Bedrooms: <span data-bind="text: bedroom_number"></span>,
                        Bathrooms: <span data-bind="text: bathroom_number"></span>
                    </div>
                    <div class="summary" data-bind="text: summary"></div>
                </div>
            </div>

            <script type="text/html" id="resultItemTemplate">
                <li class="listing arrow">
                    <a href="#" data-bind="click: $root.showDetail.bind($root, $data)">
                        <img class="thumbnail" data-bind="attr: { src: thumb_url }" />
                        <div class="detail">
                            <div class="price" data-bind="currency: price"></div>
                            <div class="title" data-bind="text: title"></div>
                        </div>
                    </a>
                </li>
            </script>

        </div>
    </body>
</html>
